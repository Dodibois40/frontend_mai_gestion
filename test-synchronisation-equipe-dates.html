<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Synchronisation √âquipe & Dates</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            color: #333;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2.5rem;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 5px solid #667eea;
        }
        .test-section h3 {
            color: #667eea;
            margin-top: 0;
            font-size: 1.5rem;
        }
        .scenario {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border: 2px solid #e9ecef;
        }
        .scenario h4 {
            color: #495057;
            margin-top: 0;
            font-size: 1.2rem;
        }
        .before-after {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .before, .after {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .before {
            background: #ffebee;
            border: 2px solid #f44336;
        }
        .after {
            background: #e8f5e8;
            border: 2px solid #4caf50;
        }
        .before h5, .after h5 {
            margin-top: 0;
            font-size: 1.1rem;
        }
        .before h5 {
            color: #c62828;
        }
        .after h5 {
            color: #2e7d32;
        }
        .fix-list {
            background: #fff3cd;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #ffc107;
            margin: 20px 0;
        }
        .fix-list h4 {
            color: #856404;
            margin-top: 0;
        }
        .fix-list ul {
            color: #856404;
            margin: 10px 0;
        }
        .fix-list li {
            margin: 8px 0;
            padding: 5px 0;
            border-bottom: 1px solid #fff2a8;
        }
        .demo-button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        .demo-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
        }
        .highlight {
            background: #ffd700;
            color: #333;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
        }
        .icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 8px;
            vertical-align: middle;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
        .step {
            background: #f8f9ff;
            border: 1px solid #e0e8ff;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .step-number {
            background: #667eea;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üë•üìÖ Synchronisation √âquipe & Dates</h1>
            <p>R√©solution du probl√®me de mise √† jour du composant "√âquipe & Ressources"</p>
        </div>

        <div class="test-section">
            <h3>üö® Probl√®me Identifi√©</h3>
            <div class="scenario">
                <h4>Situation probl√©matique</h4>
                <p>Quand l'utilisateur modifiait les dates de planification dans le composant "Temps & Planning", 
                   la section "√âquipe & Ressources" ne se mettait pas √† jour automatiquement.</p>
                <ul>
                    <li>‚ùå Changement de date de d√©but ‚Üí Aucun recalcul d'√©quipe</li>
                    <li>‚ùå Changement de date de fin ‚Üí Donn√©es d'√©quipe obsol√®tes</li>
                    <li>‚ùå Nouvelle dur√©e disponible ‚Üí R√©partition non ajust√©e</li>
                    <li>‚ùå Perte de synchronisation entre composants</li>
                </ul>
                <p class="error">üì± <strong>Impact :</strong> Donn√©es incoh√©rentes entre planning et √©quipe</p>
            </div>
        </div>

        <div class="test-section">
            <h3>üîß Solution Impl√©ment√©e</h3>
            <div class="fix-list">
                <h4>üéØ Corrections Apport√©es</h4>
                <ul>
                    <li><strong>Synchronisation √©tendue :</strong> BlocEquipe √©coute aussi les changements de dates</li>
                    <li><strong>Recalcul automatique :</strong> R√©partition fabrication/pose recalcul√©e</li>
                    <li><strong>Affichage des dates :</strong> Section "Synchronis√© avec le planning" ajout√©e</li>
                    <li><strong>Logs de d√©bogage :</strong> Console.log pour tracer les synchronisations</li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <h3>üé® Avant / Apr√®s</h3>
            <div class="before-after">
                <div class="before">
                    <h5>‚ùå Avant (Probl√©matique)</h5>
                    <div class="code-block">
                        <div>useEffect(() => {</div>
                        <div>  if (estimation.totalDemiJournees !== ...</div>
                        <div>  // Seulement totalDemiJournees</div>
                        <div>}, [estimation]);</div>
                        <div style="margin-top: 10px; color: #ff6b6b;">
                            üö´ Pas de synchronisation dates
                        </div>
                    </div>
                </div>
                <div class="after">
                    <h5>‚úÖ Apr√®s (Synchronis√©)</h5>
                    <div class="code-block">
                        <div>useEffect(() => {</div>
                        <div>  if (estimation.totalDemiJournees !== ... ||</div>
                        <div>      estimation.dateCommencement !== ... ||</div>
                        <div>      estimation.dateReception !== ...)</div>
                        <div>  // Recalcul automatique</div>
                        <div>}, [dates, totalDemiJournees]);</div>
                        <div style="margin-top: 10px; color: #4caf50;">
                            ‚úÖ Synchronisation compl√®te
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3>üß™ Protocole de Test</h3>
            
            <div class="step">
                <div class="step-number">1</div>
                <strong>Cr√©er une estimation</strong>
                <ul>
                    <li>Saisir un montant de devis (ex: 50,000‚Ç¨)</li>
                    <li>Valider l'estimation automatique</li>
                    <li>Observer les donn√©es d'√©quipe initiales</li>
                </ul>
            </div>

            <div class="step">
                <div class="step-number">2</div>
                <strong>Modifier les dates</strong>
                <ul>
                    <li>Aller dans "Temps & Planning"</li>
                    <li>Changer la date de d√©but</li>
                    <li>Changer la date de fin</li>
                </ul>
            </div>

            <div class="step">
                <div class="step-number">3</div>
                <strong>V√©rifier la synchronisation</strong>
                <ul>
                    <li class="success">‚úÖ Section "Synchronis√© avec le planning" appara√Æt</li>
                    <li class="success">‚úÖ Dates affich√©es dans "√âquipe & Ressources"</li>
                    <li class="success">‚úÖ R√©partition fabrication/pose recalcul√©e</li>
                    <li class="success">‚úÖ Console.log de synchronisation visible</li>
                </ul>
            </div>

            <div class="step">
                <div class="step-number">4</div>
                <strong>Tester diff√©rents sc√©narios</strong>
                <ul>
                    <li>Dates courtes ‚Üí V√©rifier la r√©partition</li>
                    <li>Dates longues ‚Üí V√©rifier l'adaptation</li>
                    <li>Boutons rapides ‚Üí V√©rifier la synchronisation</li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <h3>üîç D√©tails Techniques</h3>
            <div class="code-block">
// Nouvelles d√©pendances du useEffect
useEffect(() => {
  if (estimation.totalDemiJournees !== editableData.totalDemiJournees ||
      estimation.dateCommencement !== editableData.dateCommencement ||
      estimation.dateReception !== editableData.dateReception) {
    
    // Recalcul automatique de la r√©partition
    const { fabrication, pose } = calculerRepartition(estimation.totalDemiJournees);
    
    setEditableData(prev => ({
      ...prev,
      totalDemiJournees: estimation.totalDemiJournees || 0,
      demiJourneesFabrication: estimation.demiJourneesFabrication || fabrication,
      demiJourneesPose: estimation.demiJourneesPose || pose,
      dateCommencement: estimation.dateCommencement,
      dateReception: estimation.dateReception
    }));
    
    console.log('üë• √âquipe synchronis√©e avec nouvelles donn√©es');
  }
}, [estimation.totalDemiJournees, estimation.dateCommencement, estimation.dateReception]);

// Nouvelle section d'affichage des dates
{(editableData.dateCommencement || editableData.dateReception) && (
  &lt;div className="bg-green-50 border border-green-200 rounded-lg p-3"&gt;
    &lt;div className="flex items-center gap-2 text-green-800 font-medium mb-2"&gt;
      &lt;IconCalendarEvent className="w-4 h-4" /&gt;
      Synchronis√© avec le planning
    &lt;/div&gt;
    // Affichage des dates format√©es
  &lt;/div&gt;
)}
            </div>
        </div>

        <div class="test-section">
            <h3>üéØ Nouvelles Fonctionnalit√©s</h3>
            <div class="scenario">
                <h4>Am√©liorations de l'Interface</h4>
                <ul>
                    <li><span class="success">‚úÖ Section "Synchronis√© avec le planning"</span> - Affichage des dates actives</li>
                    <li><span class="success">‚úÖ Dates format√©es</span> - Format fran√ßais lisible (ex: "lun. 15 juil.")</li>
                    <li><span class="success">‚úÖ Recalcul automatique</span> - R√©partition mise √† jour en temps r√©el</li>
                    <li><span class="success">‚úÖ Logging am√©lior√©</span> - Tra√ßabilit√© des synchronisations</li>
                    <li><span class="success">‚úÖ √âtats coh√©rents</span> - Donn√©es always synchronis√©es</li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <h3>üîÆ Flux de Synchronisation</h3>
            <div class="scenario">
                <h4>S√©quence d'√âv√©nements</h4>
                <ol>
                    <li><strong>Utilisateur modifie une date</strong> dans BlocTemps</li>
                    <li><strong>BlocTemps appelle onEstimationChange</strong> avec les nouvelles dates</li>
                    <li><strong>AffaireEstimation met √† jour</strong> l'√©tat estimation</li>
                    <li><strong>BlocEquipe d√©tecte le changement</strong> via useEffect</li>
                    <li><strong>Recalcul automatique</strong> de la r√©partition fabrication/pose</li>
                    <li><strong>Interface mise √† jour</strong> avec les nouvelles donn√©es</li>
                    <li><strong>Section synchronisation affich√©e</strong> avec les dates</li>
                </ol>
            </div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button class="demo-button" onclick="window.location.href='http://localhost:8080'">
                üöÄ Tester la Synchronisation Live
            </button>
        </div>

        <div style="text-align: center; margin-top: 20px; padding: 20px; background: #e3f2fd; border-radius: 10px;">
            <p><strong>üì± Status :</strong> <span class="success">‚úÖ Probl√®me r√©solu</span></p>
            <p><strong>üîÑ Synchronisation :</strong> <span class="success">‚úÖ Temps r√©el</span></p>
            <p><strong>üß™ Tests :</strong> <span class="success">‚úÖ Protocole d√©fini</span></p>
        </div>
    </div>

    <script>
        // Animation d'entr√©e
        document.addEventListener('DOMContentLoaded', function() {
            const sections = document.querySelectorAll('.test-section');
            sections.forEach((section, index) => {
                section.style.opacity = '0';
                section.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    section.style.transition = 'all 0.5s ease';
                    section.style.opacity = '1';
                    section.style.transform = 'translateY(0)';
                }, index * 200);
            });
        });

        // Simulation de test interactif
        function simulateTest() {
            const steps = document.querySelectorAll('.step');
            let currentStep = 0;
            
            function highlightStep() {
                if (currentStep < steps.length) {
                    steps[currentStep].style.background = '#e8f5e8';
                    steps[currentStep].style.border = '2px solid #4caf50';
                    
                    setTimeout(() => {
                        steps[currentStep].style.background = '#f8f9ff';
                        steps[currentStep].style.border = '1px solid #e0e8ff';
                        currentStep++;
                        highlightStep();
                    }, 1500);
                }
            }
            
            highlightStep();
        }

        // Auto-lancer la simulation apr√®s 2 secondes
        setTimeout(simulateTest, 2000);
    </script>
</body>
</html> 